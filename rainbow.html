<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>ZIM Frame - Fit Template</title>

<script src="https://d309knd7es5f10.cloudfront.net/createjs_1.1_min.js"></script>
<script src="https://d309knd7es5f10.cloudfront.net/zim_9.3.0.js"></script>
<!-- use zimjs.com/distill for minified individual functions! -->

<script>

    var scaling = "fit"; // this will resize to fit inside the screen dimensions
    var width = 1024;
    var height = 768;
    var color = light; // ZIM colors like green, blue, pink, faint, clear, etc. available globally
    var outerColor = dark;
    var assets = [
        "background.png",
        "beam.png",
        "bottom-clouds.png",
        "first.png",
        "second.png",
        "star.png",
        "stars.png",
        "unicorn-distance.png",
        "unicorn-boss.png",
        "atmospheric.mp3",
        "lightningorange1.png",
        "lightningorange2.png",
        "lightningorange3.png",
        "lightningred1.png",
        "lightningred2.png",
        "lightningred3.png",
        "lightningyellow1.png",
        "lightningyellow2.png",
        "lightningyellow3.png",
        "star-power.png"];
    var path = "assets/";

    var frame = new Frame(scaling, width, height, color, outerColor, assets, path, new Waiter());
    frame.on("ready", function() {
        zog("ready from ZIM Frame"); // logs in console (F12 - choose console)

        var stage = frame.stage;
        var stageW = frame.width;
        var stageH = frame.height;

        frame.asset("background.png").addTo();
        // frame.loadAssets(["atmospheric.mp3"], "assets/").play({volume:.5}); // attempt to load music
        var background = new Scroller(frame.asset("background.png").addTo(), .5);
        var stars = new Scroller(frame.asset("stars.png").addTo(), .15);
        var beam = new Scroller(frame.asset("beam.png").addTo(), .30);
        var clouds = new Scroller(frame.asset("bottom-clouds.png").addTo(), .75);
        var rect = new Rectangle(878, 677).pos(stageW-450, stageH-750).alp(0);
        var boss = frame.asset("unicorn-boss.png").addTo(rect);//.pos(stageW-450, stageH-750).alp(.1);
        var star = frame.asset("star.png");
        var unicont = new Container().center();
        var unicorn = frame.asset("first.png").sca(.5).centerReg(unicont).drag();
        var trackerbox = new Container().pos({x:stageW-750, y: stageH-100});
        var tracker = frame.asset("unicorn-distance.png").sca(.15);

        var starPower = frame.asset("star-power.png")
          .sca(0.15)
          .outline()
          .animate({
            props:{scale:0.18},
            time:500,
            loop:true,
            rewind:true,
            from:true
          });

        var runner = new Slider({
          min: 0,
          max: 3000,
          button: tracker,
          barLength: 500,
          barColor: pink
        }).center(trackerbox);

        stage.on("stagemousemove", startGame, null, true); // only once
        	function startGame() {
            Ticker.add(animate);
            dropLightning();
            dropStars();
          }

    //Function to drop the stars
        var stars = new Container();
        stage.addChild(stars);

        function dropStars(){
          interval({min:200, max:1200}, function(){
            var powerup = starPower.clone();
            powerup
              .reg(powerup.width/2, powerup.height)
              .loc(rand(powerup.height, stage.height-powerup.height), -10)
              .addTo(stars);
          });
        }

    //function to drop the bolts
        var lightning = new Container();
        stage.addChild(lightning);

        function dropLightning(){
          interval({min:200, max:1200}, function(){
            var bolts = [
              frame.asset("lightningorange1.png"),
              frame.asset("lightningorange2.png"),
              frame.asset("lightningorange3.png"),
              frame.asset("lightningred1.png"),
              frame.asset("lightningred2.png"),
              frame.asset("lightningred3.png"),
              frame.asset("lightningyellow1.png"),
              frame.asset("lightningyellow2.png"),
              frame.asset("lightningyellow3.png")
            ];

            var bolt = bolts[rand(bolts.length-1)].sca(.15).clone();
            bolt
              .reg(bolt.width/2, bolt.height)
              .loc(rand(bolt.height, stage.height-bolt.height), -10)
              .addTo(lightning);
          });
        }

        var damp = new Damp( null, .3);
        damp.immediate(unicorn.x);

        var speed = 10;
            function animate(){
              loop(stars, function(starPower){
                starPower.x-=speed;
                if (unicorn.hitTestBounds(starPower)){
                  //unicorn point increase

                }
              }, true);
              loop(lightning, function(bolt){
                bolt.x-=speed;
                if (unicorn.hitTestBounds(bolt)){
                  //unicorn health decrease
                }
              }, true);
          }

        //Angela's Emitter.
        var emit =  new Emitter({
           obj: [star.sca(.09),new Rectangle(10), new Circle(10)],
           random: {color:[blue, moon, pink, yellow]},
           angle: {min:10, max:80},
           force: 1
        }).center(unicorn).pos(440,410).rot(60)
        .addTo(unicont).bot().sca(1.75);

        //Angela's motion controller.
        var mcontroller = new MotionController({
          target:unicont,
          type:"mousemove",
          speed:100,
          damp:.2,
          minPercentSpeed:-6000,
          maxPercentSpeed:6000
        });


        stage.update(); // this is needed to show any changes

    }); // end of ready

</script>

<meta name="viewport" content="width=device-width, user-scalable=no" />

</head>

<body>
<!-- canvas with id="myCanvas" is made by zim Frame -->
</body>
</html>
