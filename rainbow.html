<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>ZIM Frame - Fit Template</title>

<script src="https://d309knd7es5f10.cloudfront.net/createjs_1.1_min.js"></script>
<script src="https://d309knd7es5f10.cloudfront.net/zim_9.3.0.js"></script>
<!-- use zimjs.com/distill for minified individual functions! -->

<script>

    var scaling = "fit"; // this will resize to fit inside the screen dimensions
    var width = 1024;
    var height = 768;
    var color = light; // ZIM colors like green, blue, pink, faint, clear, etc. available globally
    var outerColor = dark;
    var assets = [
        "background.png",
        "beam.png",
        "bottom-clouds.png",
        "first.png",
        "second.png",
        "third.png",
        "star.png",
        "stars.png",
        "unicorn-distance.png",
        "unicorn-boss.png",
        "atmospheric.mp3",
        "electricshock.mp3",
        "collectstar.mp3",
        "lightningorange1.png",
        "lightningorange2.png",
        "lightningorange3.png",
        "lightningred1.png",
        "lightningred2.png",
        "lightningred3.png",
        "lightningyellow1.png",
        "lightningyellow2.png",
        "lightningyellow3.png",
        "star-power.png",
        "friend.png",
        "heart.png",
        "boss-distance.png"];
    var path = "assets/";

    var frame = new Frame(scaling, width, height, color, outerColor, assets, path, new Waiter());
    frame.on("ready", function() {
        zog("ready from ZIM Frame"); // logs in console (F12 - choose console)

        var stage = frame.stage;
        var stageW = frame.width;
        var stageH = frame.height;

        frame.asset("background.png").addTo();
        frame.asset("atmospheric.mp3").play({volume:.5, loop});
        // frame.loadAssets(["atmospheric.mp3"], "assets/").play({volume:.5}); // attempt to load music
        var unicornb = frame.asset("third.png")
        var unicorng = frame.asset("second.png")
        var background = new Scroller(frame.asset("background.png").addTo(), .5);
        var stars = new Scroller(frame.asset("stars.png").addTo(), .15);
        var beam = new Scroller(frame.asset("beam.png").addTo(), .30);
        var clouds = new Scroller(frame.asset("bottom-clouds.png").addTo(), .75);
        var rect = new Rectangle(878, 677).pos(stageW-450, stageH-750).alp(0);
        var boss = frame.asset("unicorn-boss.png")//.pos(stageW-450, stageH-750).alp(.1);
        var star = frame.asset("star.png");
        var trackend = frame.asset("boss-distance.png").sca(.10);
        var unicont = new Container(120,50).centerReg();
        var unicorn = frame.asset("first.png").sca(.5).centerReg(unicont);
        var tracker = frame.asset("unicorn-distance.png").sca(.15);
        var friend = frame.asset("friend.png")
        // stage.on("stagemousemove", function() {
        //    if (count === 10){
        //      unicorn.removeFrom(unicont);
        //      var unicorng = frame.asset("second.png").sca(.5).centerReg(unicont);
        //      stage.update();
        //         if( count === 20){
        //         unicorng.removeFrom(unicont);
        //         var unicornb = frame.asset("third.png").sca(.5).centerReg(unicont)
        //         stage.update();
        //         }
        //       }
        //     });

        var starPower = frame.asset("star-power.png")
          .sca(0.15)
          .outline()
          .animate({
            props:{scale:0.18},
            time:500,
            loop:true,
            rewind:true,
            from:true
          });

    //startgame w/ mouse move.
        stage.on("stagemousemove", startGame, null, true); // only once
        	function startGame() {
            Ticker.add(animate);
            dropLightning();
            dropStars();
            gameTracker();
          }

    //function for game tracker.
        var trackerbox = new Container().centerReg();
        trackerbox.pos(275, stageH-50);
        var runnerbar = new Rectangle({width: 500, height:3, color: pink}).addTo(trackerbox);
        tracker.addTo(trackerbox).mov(-20,-20);
        trackend.addTo(trackerbox).mov(450,-30);

        function gameTracker(){
          interval(300, function() {
            var runner = tracker;
            runner.x += 1;
          });
        }

    //Function to drop the stars
        var stars = new Container(stageW, stageH).center();

        function dropStars(){
          interval({min:500, max:5000}, function(){
            var powerup = starPower.clone();
            powerup
              .reg(powerup.width/2, powerup.height)
              .loc(stageW+50, rand(stage.height-powerup.width))
              .addTo(stars);
          });
        }


    //function to drop the bolts
        var lightning = new Container(stageW, stageH).center();

        function dropLightning(){
          interval({min:500, max:800}, function(){
            var bolts = [
              frame.asset("lightningorange1.png"),
              frame.asset("lightningorange2.png"),
              frame.asset("lightningorange3.png"),
              frame.asset("lightningred1.png"),
              frame.asset("lightningred2.png"),
              frame.asset("lightningred3.png"),
              frame.asset("lightningyellow1.png"),
              frame.asset("lightningyellow2.png"),
              frame.asset("lightningyellow3.png")
            ];

            var bolt = bolts[rand(bolts.length-1)].sca(.25).clone();
            bolt
              .rot(90)
              .reg(bolt.width/2, bolt.height)
              .loc(stageW+50, rand(stage.height-bolt.width))
              .addTo(lightning);
          });
        }

        var speed = 10;
            function animate(){
                loop(stars, function(powerup){
                  powerup.x-=speed;
                  if (unicont.hitTestRect(powerup)){
                    //unicorn point increase
                    stars.removeChild(powerup);
                    frame.asset("collectstar.mp3").play({volume:1.1});
                    count+=10;
                    score.text=count;
                    if (count == 50){
                      evolve();
                      unicorn.removeFrom(unicont);
                      unicorng.sca(.5).centerReg(unicont);
                      stage.update()
                      }

                    if(count == 100){
                      evolve();
                       unicorng.removeFrom(unicont);
                       unicornb.sca(.5).centerReg(unicont)
                       stage.update();
                     }
                    }
                }, true);
                loop(lightning, function(bolt){
                  bolt.x-=speed;
                  if (unicont.hitTestRect(bolt)){
                    //unicorn health decrease
                    lightning.removeChild(bolt);
                    heartCont.removeChildAt(0);
                    frame.asset("electricshock.mp3").play({volume:1});
                    score.text=count;
                    stage.update();
                  }
                }, true);
            }

          //scores. When the unicorn container hits the starPower, the score increases by 10.
          var count = 0;
          var scoreCont = new Container(100,30).centerReg(stage).pos(860,30);
          var score = new Label({text:count,color:white}).addTo(scoreCont).center().mov(0,50);
          var scoreLabel = new Label({
            text:"YOUR SCORE",
            size:20,
            font:"arial",
            color:moon,
            backgroundColor:pink,
            corner:10
          }).addTo(scoreCont).center();

        //Angela's Emitter.
        var emit =  new Emitter({
           obj: [star.sca(.09),new Rectangle(10), new Circle(10)],
           random: {color:[blue, moon, pink, yellow]},
           angle: {min:10, max:80},
           force: 1
        }).center(unicorn).pos(440,410).rot(60)
        .addTo(unicont).bot().sca(1.75);

        //Angela's motion controller.
        var mcontroller = new MotionController({
          target:unicont,
          type:"mousemove",
          speed:100,
          damp:.2,
          minPercentSpeed:-6000,
          maxPercentSpeed:6000
        });

        //beam for the unicorn's attack.
        function beam(){
            var star2 = frame.asset("star.png")
            var beam = new Emitter({obj:
                  [star2.sca(0.10).rot(20),
                  new Circle(10),
                  new Rectangle(10,10),
                  new Rectangle(10,80).rot(90),
                  {type:"shape", s:[blue,"pink"], ss:15}
                  ],
                  random:{color:[yellow, orange, moon]},
                  force:2,
                  wind:200,
                  num:2,
                  startPaused: true
            }).centerReg().mov(90,-60).addTo(unicont);
            beam.on("click", startPaused(true))
        }

        //hearts assets. from right to left: heart 1 heart 2 heart 3
        var heartCont = new Container(100,30).centerReg();
        var heart1 = new Sprite (frame.asset("heart.png")).sca(0.09).centerReg().mov(70,0).addTo(heartCont, 0);
        var heart2 = new Sprite(frame.asset("heart.png")).sca(0.09).centerReg().addTo(heartCont, 1);
        var heart3 = new Sprite (frame.asset("heart.png")).sca(0.09).centerReg().mov(-70,0).addTo(heartCont, 2);
        heartCont.pos(100,50);

        //explosion for when the unicorn evolves
        function evolve(){
        var emit =  new Emitter({
           obj:[star.sca(.09),new Rectangle(10,10), new Circle(10)],
           random:{color:[blue, moon, pink,yellow]},
           num:10,
           force:10,
            })
            .centerReg(unicont)
            emit.spurt({time:500});
          };

        //make the boss appear
        bossAppear();

        function bossAppear(){
        boss.center().mov(530,0).sca(.90)
        .animate({
          props:{x:1300, y:0},
          time:1500,
          loop:false,
          rewind:false,
          from:true,
          sequence:500
          });
          }
        //friend appears
        friendAppear();
        function friendAppear(){
          friend.center().sca(.35).mov(500,180)
          .animate({
            props:{alpha:0},
            time:5000,
            loop:false,
            rewind:false,
            from:true,
            sequence:500
          });
          var fo = new Emitter({
            obj:[new Circle(20,40)],
            random:{color:[pink,"purple", purple]},
            num:30,
            force:4
          }).sca(1.3).centerReg().mov(300,-20);
          fo.spurt({time:2000});
        };
    //end game screen
    // endGame();
    function endGame(){
    var youWon = new Label({
    text:"Congratulations! You saved your friend!",
    size:20,
    font:"arial",
    backgroundColor: pink,
    color:"white",
    labelWidth:450,
    }).center()
    .animate({
    props:{alpha:0},
    time:1000,
    loop:false,
    rewind:false,
    from:true,
    sequence:500
    });
    }
    //lose game + restart
    loseGame();
    function loseGame(){
      var youLose = new Label({
        text:"You werent able to save your friend...",
        size:20,
        font:"arial",
        color:moon,
        backgroundColor:null,
      }).center()
      .animate({
        props:{alpha:0},
        time:3000,
        loop:false,
        rewind:false,
        from:true,
        sequence:500
      }).mov(0,-70);
    var restart = new Button({
      width: 200,
      height: 75,
      label: "RESTART",
      target: "index.html",
      backgroundColor:pink,
      rollBackgroundColor: purple,
      color: moon
    }).center()
    .animate({
      props:{alpha:0},
      time:3000,
      loop:false,
      rewind:false,
      from:true,
      sequence:500
    })
.tap(function(){zgo("rainbow.html");})
    }

    stage.update(); // this is needed to show any changes
    }); // end of ready

</script>

<meta name="viewport" content="width=device-width, user-scalable=no" />

</head>

<body>
<!-- canvas with id="myCanvas" is made by zim Frame -->
</body>
</html>
